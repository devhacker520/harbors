/**
 * session支持模块
 * 需要开启redis支持
 *
 * {
 *     SZqzefTQYmAahkbdAF8v:{
 *         sessionName:sessionValue
 *     }
 * }
 */
var redis = require("redis");
var client = redis.createClient();
client.on("error", function (err) {
    console.log("Error " + err);
});
var ServerType = require('./ServerType');

//client.hmset("hosts", "mjr", "1", "another", "23", "home", "134");
//client.hdel("hosts", "mjr", "another", "home");
//client.hgetall("hosts", function (err, obj) {
//    console.dir(obj);
//});

exports.session = function(cookieName,req,res){
    client.hgetall(cookieName, function (err, obj) {
        if(err) throw err;
        req.Session = obj;
        client.expire(cookieName,harbors.config.SessionSurvavil);
        ServerType.run(req,res);
    });
};

exports.setSession = function(cookieName,session){
    client.hmset(cookieName, session);
    client.expire(cookieName,harbors.config.SessionSurvavil);
};

exports.delSession = function(cookieName,array){
    var str = '';
    for(var i=0;i<array.length;i++){
        str += ',"'+array[i]+'"';
    }
    eval('client.hdel(cookieName'+str+')');
};