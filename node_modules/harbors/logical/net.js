var net = require('net');
var Num = 0;
var server = net.createServer(function(socket){
    console.log(++Num);
    socket.write('console>');
    var Command = '';
    socket.on('data', function(chunk){
        var t = chunk+'';
        if(t=='\r\n'){
            C_C(Command,socket);
            socket.write('console>');
            Command = '';
        }else{
            Command += t;
        }
    });


    socket.on('end',function(){
        console.log('end');
        Num--;
    });


    socket.on('error',function(){
        Num--;
    });
}).listen(9999);

function C_C (str,socket){
    console.log(str)
    switch(str.replace(/\s/g,'')){
        case 'close':
            socket.end();
            break;
        case 'num':
            socket.write('num : '+Num+'\r\n');
            break;
    }
}