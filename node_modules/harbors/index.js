var harbors = require('./harbors_modules/harbors');

exports.rewrite = function(name, rewrite){
    if(typeof(name)!='string'){
        harbors.error("Add rewrite module error : name is not string!");
        return undefined;
    }
    if(typeof(rewrite)!='function'){
        harbors.error("Add rewrite module error : rewrite is not function!");
        return undefined;
    }
    harbors._rewrite[name] = rewrite;
};

exports.config = function(config){
    if(typeof(config)!='object'){
        harbors.error("Add config error : config is not object!");
        return undefined;
    }
    harbors.$utils.mergeAll(harbors._config.server, config.server);
    harbors._config.vhost.push.apply(harbors._config.vhost, config.vhost);
};

/**
 * TODO :
 * 监听文件变化重新载入文件模块，实现动态的开发
 */
exports.start = function(){
    if(harbors.cluster.isMaster){
        harbors.$cluster.master();
    }else{
        harbors.$server.mergeConfig();
        harbors.$server.listen();
        harbors.$server.createServer();
    }
};