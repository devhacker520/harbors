var harbors = require('./harbors_modules/harbors');

var cluster = require('cluster');

var _utils = require('./harbors_modules/utils');
var _server = require('./harbors_modules/server');

exports.start = function(){
    if(cluster.isMaster){
        _server.MASTERPROCESS();
    }else{
        _server.WORKERPROCESS();
    }
};

exports.rewrite = function(name, rewrite){
    if(typeof(name)!='string'){
        harbors.error("Add rewrite module error : name is not string!");
        return void 0;
    }
    if(typeof(rewrite)!='function'){
        harbors.error("Add rewrite module error : rewrite is not function!");
        return void 0;
    }
    harbors._rewrite[name] = rewrite;
};

exports.config = function(config){
    if(typeof(config)!='object'){
        harbors.error("Add config error : config is not object!");
        return void 0;
    }
    _utils.mergeAll(harbors._config, config.server);
    harbors._vhost.push.apply(harbors._vhost, config.vhost);
};