var path = require('path');
var jade = require('jade');
/**
 * 动态jade模板渲染函数
 *
 * @param {string} file
 * @param {object} req
 * @param {object} res
 */
module.exports = function(file,obj){
    var $this = this;
    var realFile = path.normalize($this.config.baseDir+'/host/'+$this.vhost.serverDir+'/view/'+file);
    //调试流程
    jade.renderFile(realFile, obj||{}, function (err, html) {

        if (err) {
            $this['500']();
            console.log(err);
        }else{
            var expires = new Date();
            expires.setTime(expires.getTime() + $this.vhost.dynamicTime);
            $this['200']({
                type:"text/html; charset=utf-8",
                expires:expires,
                length:html.length
            });
            $this.res.end(html);

        }

    });
};