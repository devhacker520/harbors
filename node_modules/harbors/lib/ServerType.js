/**
 * 初始化服务器类型
 */
var Request = require('../lib/Request');
var Response = require('../lib/Response');
var redis = require("redis");
var client = redis.createClient();
client.on("error", function (err) {
    console.log("Error " + err);
});
/**
 * 静态类型服务器
 *
 * @param {object} req
 * @param {object} res
 */
exports.static = function(req,res){
    Response.display('/'+req.vhost['baseDir']+req.url,req,res);
};

/**
 * 动态类型服务器
 * @param {object} req
 * @param {object} res
 */
exports.dynamic = function(req,res){

    req.Cookie = Request.cookie(req,res);

    res.display = function(file){
        Response.display(file,req,res);
    };

    res.render = function(file,obj){
        Response.render(file,obj,req,res)
    };

    res.setCookie = function(cookie,time,path){
        Response.setCookie(cookie,time,path||'/',req,res);
    };

    res.setSession = function(session){
        Response.setSession(session,req,res);
    };

    res.delSession = function(session){
        Response.delSession(session,req,res);
    };
//    res.setSession({abc:"test"});
    Request.session(req,res);

    !harbors.config.session&&run(req,res);

};

exports.run = function run(req,res){
    harbors._dev&&console.log('cortroller:'+harbors.config.baseDir+'/controller/'+req.vhost['baseDir']+'/filter');
    require(harbors.config.baseDir+'/controller/'+req.vhost['baseDir']+'/filter')(req,res);
};