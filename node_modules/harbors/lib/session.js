var querystring = require('querystring');
var _utils = require('./utils');

module.exports = function(){
    var $this = this;
    var length = arguments.length;
    switch(length){
        case 0:
            return $this.req.session;
            break;
        case 1:
            return $this.req.session[arguments[0]];
            break;
        default:
            $this.req.session[arguments[0]] = arguments[1];
            if($this.req.cookie[$this.config.sessionId]&&$this.req.session!=null){
                $this.res.redis.set($this.req.cookie[$this.config.sessionId], JSON.stringify($this.req.session));
                //过期时间
                $this.res.redis.expire($this.req.cookie[$this.config.sessionId], (arguments[2]&&arguments[2].expire)||$this.config.SessionSurvavil/1000);
            }else{
                var a = _utils.uid(20);
                $this.cookie($this.config.sessionId,a,{httponly:true});
                $this.res.redis.set(a, JSON.stringify($this.req.session));
                //过期时间
                $this.res.redis.expire(a, (arguments[2]&&arguments[2].expire)||$this.config.SessionSurvavil/1000);
            }
            return $this;
    }
};