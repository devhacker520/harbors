var app = {
    init:function(){
        //连接数据库
        var mq = require("mysql");
        app.mysql = mq.createConnection({
            host : harbors.config.mysqlHost,
            user: harbors.config.mysqlUser,
            password: harbors.config.mysqlPassword
        });
        app.mysql.connect();
        //连接默认数据库
        app.changeDatabase(harbors.config.mysqldatabase);

        return {
            changeDatabase:app.changeDatabase,
            findData:app.findData,
            insertData:app.insertData,
            deleteData:app.deleteData,
            count:app.count,
            query:app.query
        };
    },
    changeDatabase:function(database){
        app.mysql.query("use "+database);
    },
    findData:function(table,condition,callback){
        var result = '';
        for(var i in condition){
            result=='' ? (result+=' '+i+'="'+condition[i]+'"') : (result+=' and '+i+'="'+condition[i]+'"');
        }
        app.mysql.query("select * from "+table+" where"+result, function(err, rs, fields){
            typeof(callback)=='function' && callback(rs);
        });
    },
    insertData:function(table,condition,callback){
        var result = '';
        var result2 = '';
        for(var i in condition){
            result=='' ? (result+=i) : (result+=','+i);
            result2=='' ? (result2+="'"+condition[i]+"'") : (result2+=",'"+condition[i]+"'");
        }
        app.mysql.query("insert into "+table+" ("+result+") values ("+result2+")", function(err, rs, fields){
            typeof(callback)=='function' && callback(rs);
        });
    },
    deleteData:function(table,condition,callback){
        var result = '';
        for(var i in condition){
            result=='' ? (result+=' '+i+'="'+condition[i]+'"') : (result+=' and '+i+'="'+condition[i]+'"');
        }
        app.mysql.query("delete from "+table+" where"+result, function(err, rs, fields){
            typeof(callback)=='function' && callback(rs);
        });
    },
    count:function(table,condition,callback){
        var result = '';
        for(var i in condition){
            result=='' ? (result+=' '+i+'="'+condition[i]+'"') : (result+=' and '+i+'="'+condition[i]+'"');
        }
        app.mysql.query("select count(*) from "+table+" where"+result, function(err, rs, fields){
            typeof(callback)=='function' && callback(rs[0]['count(*)']);
        });
    },
    query:function(query){
        app.mysql.query(query);
    }
};

module.exports = app;