/**
 * Path analysis module
 */
var path = require('path');
var fs = require('fs');
var querystring = require('querystring');

var $url = require('../lib/url');

/**
 * 计算并且返回来路虚拟主机的config
 * @param req
 * @returns {*}
 */
exports.vhost = function(req){
    if(harbors.config.server.vhost=='false')
        return harbors.config.server;

    //判断缓存是否存在
    if(harbors._vhost[req.headers.host]){
        //console.log(harbors._vhost[req.headers.host]);
        return harbors._vhost[req.headers.host];
    }

    //判断是否为80端口（默认省略），自动加上:80
    var host = $url.host(req.headers.host);

    return $url.vhost(host,req);
};

exports.path = function(req,config){

    req.url = $url.completion(req.url);

    var result = $url.analytical(req.url,config.module);

    if(harbors._rewrite[config.rewrite]){
        harbors.debug('Run path rewrite [Module module/path.js]');
        result._url = harbors._rewrite[config.rewrite](req.url);
    }else{
        result._url = result.url;
    }

    return result;
};