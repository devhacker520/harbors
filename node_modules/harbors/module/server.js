var $sync = require('../lib/sync');
var $multipart = require('./multipart');
var _session = require('../module/session');
var querystring = require('querystring');

exports.dyM = function(request){

    $sync('normal')

        .add(function(next){
            //解析cookie、session
            _session.analysis(request,next);
        })

        .add(function(next){
            //接收post
            $multipart(request,next);
        })

        .end(function(){
            require(request.vhost.dir + request.path._url + request.vhost.module)(request);
        });
};