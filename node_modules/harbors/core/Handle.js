var harbors = require('../index');

harbors.Handle = harbors.Class.extend({

    _handle: null,
    _host: null,

    ctor: function(handle){
        this._handle = handle;
    },

    getHandle: function(){

        var self = this;
        return function(req, res){
            var _h = req.headers.host;
            var _t = null;

            for(var p in self._host){
                if(!self._host[p]['regexp']){
                    self._host[p]['regexp'] = new RegExp('^' + p);
                }

                if(self._host[p]['regexp'].test(_h)){
                    _t = p;
                    break;
                }
            }

            (_t ? self._host[_t] : self._handle)(req, res);
        }
    },

    addHost: function(name, handle){
        if(this._host === null) this._host = {};

        this._host[name] = handle;
    }
});

harbors.Handle.create = function(handle){

    if(typeof handle !== 'function' && handle) throw 'error';

    return new harbors.Handle(handle);

};