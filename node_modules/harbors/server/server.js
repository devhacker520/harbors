var app = {
    init:function(req,res){

        //封装vhost虚拟主机名
        req.vhost = harbors.config.vhost ? req.headers.host.split(":")[0] : '';
        //封装display方法
        res.display = require('../lib/display').init(req,res).display;

        //递交控制权限
        try{
            harbors.config.vhost ? (function(){//虚拟主机功能打开
                require('./type/'+harbors.vhost[req.vhost].type||harbors.config.serverType).init(req,res,true);
            })() : (function(){//虚拟主机功能关闭
                require('./type/'+harbors.config.serverType).init(req,res,false);
            })();
        }catch(err){
            console.log(err);
            harbors.config.deBug&&console.log("解析路由路径出错。");
            res.writeHead(404, {"Content-Type": "text/plain", "Connection": "close"});
            res.end("host is lost");
        }
    }
};

module.exports = app;