var path = require('path');
var php = require('./php');

var _session_ = require('./session');
var _multipart_ = require('./multipart');

module.exports = {
    'nodejs':function(file,request){
        try{
            request.sync('normal')
                .add(function(next){
                    //解析cookie、session
                    _session_.analysis(request,next);
                })

                .add(function(next){
                    //接收post
                    _multipart_(request,next);
                })

                .end(function(){
                    request._headers = {"Cache-Control":"no-store, no-cache, must-revalidate, post-check=0, pre-check=0"};
                    request._headers = {"X-Powered-By":"NODEJS"+process.version};
                    request._headers = {"Pragma":"no-cache"};
                    require(path.join(request.config.dir,file))(request);
                });
        }catch(err){
            harbors.error(err);
            request.error();
        }
    },
    'php':function(file,request){
        php(file,request)
    }
};