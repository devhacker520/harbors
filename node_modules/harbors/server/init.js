global.harbors = {
    Server:"Harbors/0.3.1",
    debug:false,
    config:{server:{}},//配置表
    utils:require('../lib/utils'),
    _vhost:{},//自定义虚拟主机映射表
    _rewrite:{},//自定义重写模块映射表
    _module:{},//自定义模块映射表
    log:function(string){},
    error:function(string){}
};

//导入服务器模块
var __config__ = require('../lib/config');
var _cluster_ = require('./cluster');

/**
 * 读取ini配置文件
 * @param file
 */
exports.config = function(file){
    harbors.log("读取配置文件"+file);
    var config = __config__.load(file);
    harbors.utils.merge(harbors.config,config,false);
    __config__.merge();
    //console.log(harbors.config)
};

/**
 * 设置自定义模块
 * @param name
 * @param fn
 */
exports.module = function(name,fn){
    if(typeof(name)=='string'&&typeof(fn)=='function')
        harbors._module[name] = fn;
    else
        console.log('require \''+name+'\' module error');
};

/**
 * 设置重写模块
 * @param name
 * @param fn
 */
exports.rewrite = function(name,fn){
    if(typeof(name)=='string'&&typeof(fn)=='function')
        harbors._rewrite[name] = fn;
    else
        console.log('rewrite \''+name+'\' module error');
};

/**
 * 开启服务
 */
exports.start = function(){
    //开启进程集群
    _cluster_.main();
};

/**
 * 读取默认配置ini
 */
harbors.log('读取默认配置...');
exports.config('./node_modules/harbors/config/config.ini');
//exports.config('./node_modules/harbors/config/vhost.ini');