/**
 * Path analysis module
 */
var path = require('path');
var fs = require('fs');
var querystring = require('querystring');

var __url__ = require('../lib/url');

/**
 * 计算并且返回来路虚拟主机的config
 * @param req
 * @returns {*}
 */
exports.vhost = function(){
    if(harbors.config.server.vhost=='false'){
        harbors.log("未开启虚拟主机功能...");
        return harbors.config.server;
    }

    //判断缓存是否存在
    if(harbors._vhost[this._host]){
        harbors.log("虚拟缓存存在...");
        //console.log(harbors._vhost[req.headers.host]);
        return harbors._vhost[this._host];
    }

    harbors.log("虚拟缓存不存在...");
    //判断是否为80端口（默认省略），自动加上:80
    var host = __url__.host(this._host);

    return __url__.vhost(host,this._host);
};

exports.path = function(){
    harbors.log("开始解析路径...");

    if(!this.config) return undefined;

    var result = __url__.analytical(this.request);

    result.extname = path.extname(result.url);

//    if(harbors._rewrite[this.config.rewrite]){
//        harbors.debug('Run path rewrite [Module module/path.js]');
//        result.url = harbors._rewrite[this.config.rewrite](URL).split('?')[0];
//    }

    return result;
};