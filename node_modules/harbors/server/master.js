var cluster = require('cluster');
var checkConfig = require('../lib/checkConfig');

//创建子进程
exports.createWorker = function(){
    console.log('Start - harbors Service process started,Listening port:'+harbors.config.listenPort+'.Open the process number:'+harbors.config.clusterNum);
    for(var i=0;i<harbors.config.clusterNum;i++){
        Worker();
    }
};
var Worker = function(){//创建工作进程
    var cp = cluster.fork();
    console.log('Start - The promoter of new process. clusterid:'+cp.workerID+'. pid:'+cp.process.pid);
    cp.on('exit', function(code, signal) {
        harbors.err('The child process an unexpected error. Code:'+code+'.');
        //重启worker（此时进程id会增加1，以示和原错误关闭进程区别）
        harbors.err('Separation of new sub process process...');
        setTimeout(Worker,2000);
    });
};

//检查config.js
exports.checkConfig = function(){
    checkConfig(harbors.config);
};

//检查vhost配置
exports.checkVhost = function(){

};

