var app = {
    init:function(req,res,vhost){
        var param = this.param(req,res);
        require(harbors.config.baseDir+'/controller' + (vhost ? ('/'+harbors.vhost[param.req.vhost]['baseDir']) : '') + '/filter')(param.req,param.res);
    },
    param:function(req,res){

        var param = require('../../lib/param').init(req,res);
        //封装访问路径以及访问文件
        req.route = param.route();
        //封装GET参数
        req.Get = param.Get();

        //封装cookie对象
        var cookie = require('../../lib/cookie').init(req,res);
        req.Cookie = cookie.Cookie();
        res.setCookie = cookie.setCookie;
        res.delCookie = cookie.delCookie;

        //封装session对象
        harbors.config.session&&(function(){
            var session = require('../../lib/session').init(req,res);
            req.Session = session.Session(req);
            res.setSession = session.setSession;
            res.delSession = session.delSession;
        })();

        //封装jade
        var jade = require('../../lib/jade').init(req,res);
        res.render = jade.render;

        return {
            req:req,
            res:res
        }
    }
};

module.exports = app;