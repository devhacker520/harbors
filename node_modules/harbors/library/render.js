var path = require('path');
var jade = require('jade');
var response = require('./response');
var cache = require('./cache');
/**
 * 动态jade模板渲染函数
 *
 * @param {string} file
 * @param {object} req
 * @param {object} res
 */
module.exports = function(file,obj,req,res,config){
    var realFile = path.normalize(harbors.config.baseDir+'/host/'+config.serverDir+'/view/'+file);
    //调试流程
    jade.renderFile(realFile, obj||{}, function (err, html) {

        if (err) {
            response.h500(res);
            console.log(err);
        }else{
            (config.cacheLevel==1 || config.cacheLevel==3) && cache.client(res);

            res.setHeader('Content-Type', "text/html; charset=utf-8");
            response.h200(res);
            res.end(html);

            (config.cacheLevel==2 || config.cacheLevel==3) && cache.mem(req,html,config);
        }

    });
};